<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ボイドモデル × 手の動き - 魚の群れシミュレーション</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(180deg, #001a33 0%, #003d5c 50%, #004d73 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow: hidden;
        }

        .container {
            max-width: 1200px;
            width: 100%;
        }

        .status-panel {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px 20px;
            margin-bottom: 20px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .status-item {
            margin: 5px 10px;
        }

        .status-label {
            font-weight: bold;
            color: rgba(255,255,255,0.7);
        }

        .status-value {
            color: #4ECDC4;
            margin-left: 5px;
        }

        .canvas-container {
            position: relative;
            background: rgba(0, 30, 60, 0.5);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        #mainCanvas {
            display: block;
            width: 100%;
            height: auto;
        }

        video {
            display: none;
        }

        .controls {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            color: white;
        }

        .control-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .control-label {
            font-weight: bold;
            min-width: 150px;
        }

        input[type="range"] {
            flex: 1;
            margin: 0 15px;
        }

        .control-value {
            min-width: 50px;
            text-align: right;
            color: #4ECDC4;
        }

        .instructions {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            color: white;
        }

        .instructions h2 {
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .instructions ul {
            list-style: none;
        }

        .instructions li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }

        .instructions li:before {
            content: "🐟";
            position: absolute;
            left: 0;
        }

        .fish-type-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            margin: 8px 0;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .fish-type-name {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .fish-color-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .fish-type-count {
            font-size: 0.9em;
            color: #4ECDC4;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="status-panel">
            <div class="status-item">
                <span class="status-label">ステータス:</span>
                <span class="status-value" id="status">初期化中...</span>
            </div>
            <div class="status-item">
                <span class="status-label">魚の数:</span>
                <span class="status-value" id="fishCount">0</span>
            </div>
            <div class="status-item">
                <span class="status-label">手の検出:</span>
                <span class="status-value" id="handStatus">❌</span>
            </div>
        </div>

        <div class="canvas-container">
            <canvas id="mainCanvas" width="1200" height="700"></canvas>
            <video id="video" playsinline></video>
        </div>

        <div class="controls">
            <h2>🎮 魚の種類</h2>
            <div id="fishTypesList"></div>
            <h2 style="margin-top: 20px;">⚙️ 全体設定</h2>
            <div class="control-row">
                <span class="control-label">逃避範囲:</span>
                <input type="range" id="avoidRangeSlider" min="50" max="300" value="150" step="10">
                <span class="control-value" id="avoidRangeValue">150</span>
            </div>
            <div class="control-row">
                <span class="control-label">逃避強度:</span>
                <input type="range" id="avoidStrengthSlider" min="1" max="10" value="5" step="0.5">
                <span class="control-value" id="avoidStrengthValue">5</span>
            </div>
        </div>

        <div class="instructions">
            <h2>📋 使い方</h2>
            <ul>
                <li>6種類・合計200匹の魚の群れが泳いでいます</li>
                <li>同じ種類の魚同士で群れを作ります</li>
                <li>手のひらを魚に近づけると魚が逃げます</li>
                <li>両手を使うとより広範囲に影響を与えられます</li>
                <li>ノートPCでも快適に動作します</li>
            </ul>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>

    <script>
        const mainCanvas = document.getElementById('mainCanvas');
        const mainCtx = mainCanvas.getContext('2d');
        const video = document.getElementById('video');
        
        const statusElement = document.getElementById('status');
        const fishCountElement = document.getElementById('fishCount');
        const handStatusElement = document.getElementById('handStatus');

        let hands = null;
        let handPositions = [];
        let boids = [];
        let animationId = null;

        // パラメータ
        let params = {
            fishCount: 80,
            avoidRange: 150,
            avoidStrength: 5,
            separationRange: 25,
            alignmentRange: 50,
            cohesionRange: 50,
            maxSpeed: 3,
            maxForce: 0.1
        };

        // 魚の種類の定義
        const fishTypes = [
            {
                name: 'クマノミ',
                color: { hue: 20, saturation: 90, lightness: 60 },
                size: { min: 6, max: 16 }, // 拡大
                maxSpeed: 2.5,
                speedVariation: 0.8, // 速度の幅
                schoolSize: 30,
                separationRange: 20,
                alignmentRange: 40,
                cohesionRange: 50,
                behaviorType: 'territorial',
                wanderStrength: 0.3
            },
            {
                name: 'タンク',
                color: { hue: 50, saturation: 85, lightness: 55 },
                size: { min: 8, max: 20 }, // 拡大
                maxSpeed: 2.0,
                speedVariation: 1.0,
                schoolSize: 25,
                separationRange: 30,
                alignmentRange: 45,
                cohesionRange: 55,
                behaviorType: 'explorer',
                wanderStrength: 0.5
            },
            {
                name: '小型青魚',
                color: { hue: 200, saturation: 80, lightness: 60 },
                size: { min: 4, max: 12 }, // 拡大
                maxSpeed: 4.0,
                speedVariation: 1.2, // より速いものも
                schoolSize: 50,
                separationRange: 15,
                alignmentRange: 60,
                cohesionRange: 70,
                behaviorType: 'schooling',
                wanderStrength: 0.1
            },
            {
                name: 'エンゼルフィッシュ',
                color: { hue: 280, saturation: 70, lightness: 65 },
                size: { min: 10, max: 24 }, // 拡大
                maxSpeed: 2.2,
                speedVariation: 0.6, // ゆったり
                schoolSize: 20,
                separationRange: 35,
                alignmentRange: 50,
                cohesionRange: 60,
                behaviorType: 'graceful',
                wanderStrength: 0.4
            },
            {
                name: 'ネオンテトラ',
                color: { hue: 180, saturation: 100, lightness: 50 },
                size: { min: 3, max: 10 }, // 拡大
                maxSpeed: 3.5,
                speedVariation: 1.3, // 非常に速いものも
                schoolSize: 40,
                separationRange: 18,
                alignmentRange: 55,
                cohesionRange: 65,
                behaviorType: 'darting',
                wanderStrength: 0.2
            },
            {
                name: 'グッピー',
                color: { hue: 320, saturation: 85, lightness: 65 },
                size: { min: 5, max: 14 }, // 拡大
                maxSpeed: 3.0,
                speedVariation: 1.1,
                schoolSize: 35,
                separationRange: 20,
                alignmentRange: 50,
                cohesionRange: 60,
                behaviorType: 'playful',
                wanderStrength: 0.6
            }
        ];

        // スライダーイベント
        document.getElementById('avoidRangeSlider').addEventListener('input', (e) => {
            params.avoidRange = parseInt(e.target.value);
            document.getElementById('avoidRangeValue').textContent = params.avoidRange;
        });

        document.getElementById('avoidStrengthSlider').addEventListener('input', (e) => {
            params.avoidStrength = parseFloat(e.target.value);
            document.getElementById('avoidStrengthValue').textContent = params.avoidStrength;
        });

        // 魚の種類リストを動的生成
        function createFishTypesList() {
            const listContainer = document.getElementById('fishTypesList');
            listContainer.innerHTML = '';
            
            fishTypes.forEach((fishType, index) => {
                const item = document.createElement('div');
                item.className = 'fish-type-item';
                
                const colorHsl = `hsl(${fishType.color.hue}, ${fishType.color.saturation}%, ${fishType.color.lightness}%)`;
                
                item.innerHTML = `
                    <div class="fish-type-name">
                        <div class="fish-color-indicator" style="background-color: ${colorHsl};"></div>
                        <span>${fishType.name}</span>
                    </div>
                    <span class="fish-type-count">${fishType.schoolSize}匹</span>
                `;
                
                listContainer.appendChild(item);
            });
        }

        // ページ読み込み時に魚の種類リストを生成
        createFishTypesList();

        // ベクトルクラス
        class Vector2D {
            constructor(x, y) {
                this.x = x;
                this.y = y;
            }

            add(v) {
                this.x += v.x;
                this.y += v.y;
                return this;
            }

            sub(v) {
                return new Vector2D(this.x - v.x, this.y - v.y);
            }

            mult(n) {
                this.x *= n;
                this.y *= n;
                return this;
            }

            div(n) {
                this.x /= n;
                this.y /= n;
                return this;
            }

            mag() {
                return Math.sqrt(this.x * this.x + this.y * this.y);
            }

            normalize() {
                const m = this.mag();
                if (m > 0) this.div(m);
                return this;
            }

            limit(max) {
                if (this.mag() > max) {
                    this.normalize().mult(max);
                }
                return this;
            }

            setMag(mag) {
                return this.normalize().mult(mag);
            }

            dist(v) {
                const dx = this.x - v.x;
                const dy = this.y - v.y;
                return Math.sqrt(dx * dx + dy * dy);
            }

            copy() {
                return new Vector2D(this.x, this.y);
            }
        }

        // ボイド（魚）クラス
        class Boid {
            constructor(x, y, fishType) {
                this.position = new Vector2D(x, y);
                this.velocity = new Vector2D(
                    Math.random() * 2 - 1,
                    Math.random() * 2 - 1
                );
                this.acceleration = new Vector2D(0, 0);
                
                // 魚の種類ごとのパラメータ
                this.fishType = fishType;
                this.maxSpeed = fishType.maxSpeed;
                this.maxForce = 0.1;
                this.behaviorType = fishType.behaviorType;
                this.wanderStrength = fishType.wanderStrength;
                
                // ランダムな動き用のパラメータ
                this.wanderAngle = Math.random() * Math.PI * 2;
                this.wanderRadius = 25;
                this.wanderDistance = 80;
                this.angleChange = 0.3;
                
                // 魚の見た目
                this.size = Math.random() * (fishType.size.max - fishType.size.min) + fishType.size.min;
                this.hue = fishType.color.hue + (Math.random() * 20 - 10); // 色に若干のバリエーション
                this.saturation = fishType.color.saturation;
                this.lightness = fishType.color.lightness;
                
                // 個体差（速度のバリエーションを種類ごとに設定）
                const baseVariation = fishType.speedVariation || 1.0;
                this.speedVariation = (0.6 + Math.random() * 0.8) * baseVariation; // 60%~140% × 種類ごとの係数
            }

            applyForce(force) {
                this.acceleration.add(force);
            }

            // 手から逃げる行動
            avoidHands(hands) {
                if (hands.length === 0) return new Vector2D(0, 0);

                let steer = new Vector2D(0, 0);
                let count = 0;

                hands.forEach(hand => {
                    const d = this.position.dist(hand);
                    if (d < params.avoidRange && d > 0) {
                        let diff = this.position.sub(hand);
                        diff.normalize();
                        diff.div(d); // 距離に応じて強度を調整
                        steer.add(diff);
                        count++;
                    }
                });

                if (count > 0) {
                    steer.div(count);
                    steer.setMag(this.maxSpeed * params.avoidStrength);
                    steer.sub(this.velocity);
                    steer.limit(this.maxForce * params.avoidStrength);
                }

                return steer;
            }

            // 分離（他の魚から離れる）
            separation(boids) {
                let steer = new Vector2D(0, 0);
                let count = 0;

                boids.forEach(other => {
                    const d = this.position.dist(other.position);
                    
                    // 同じ種類の魚との分離
                    if (other.fishType === this.fishType && d > 0 && d < this.fishType.separationRange) {
                        let diff = this.position.sub(other.position);
                        diff.normalize().div(d);
                        steer.add(diff);
                        count++;
                    }
                    // 異なる種類の魚とも最小距離を保つ（衝突回避）
                    else if (other.fishType !== this.fishType && d > 0 && d < 40) {
                        let diff = this.position.sub(other.position);
                        diff.normalize().div(d);
                        diff.mult(2.0); // 異なる種類からはさらに強く離れる
                        steer.add(diff);
                        count++;
                    }
                });

                if (count > 0) {
                    steer.div(count);
                    steer.setMag(this.maxSpeed);
                    steer.sub(this.velocity);
                    steer.limit(this.maxForce);
                }

                return steer;
            }

            // 整列（同じ方向に進む）
            alignment(boids) {
                let sum = new Vector2D(0, 0);
                let count = 0;

                boids.forEach(other => {
                    const d = this.position.dist(other.position);
                    // 同じ種類の魚とのみ群れる
                    if (other.fishType === this.fishType && d > 0 && d < this.fishType.alignmentRange) {
                        sum.add(other.velocity);
                        count++;
                    }
                });

                if (count > 0) {
                    sum.div(count);
                    sum.setMag(this.maxSpeed);
                    let steer = sum.sub(this.velocity);
                    steer.limit(this.maxForce);
                    return steer;
                }

                return new Vector2D(0, 0);
            }

            // 結合（群れの中心に向かう）
            cohesion(boids) {
                let sum = new Vector2D(0, 0);
                let count = 0;

                boids.forEach(other => {
                    const d = this.position.dist(other.position);
                    // 同じ種類の魚とのみ群れる
                    if (other.fishType === this.fishType && d > 0 && d < this.fishType.cohesionRange) {
                        sum.add(other.position);
                        count++;
                    }
                });

                if (count > 0) {
                    sum.div(count);
                    return this.seek(sum);
                }

                return new Vector2D(0, 0);
            }

            seek(target) {
                let desired = target.sub(this.position);
                desired.setMag(this.maxSpeed);
                let steer = desired.sub(this.velocity);
                steer.limit(this.maxForce);
                return steer;
            }

            // ランダムな動き（Wander behavior）
            wander() {
                // ランダムな角度変化
                this.wanderAngle += (Math.random() - 0.5) * this.angleChange;
                
                // 進行方向の先にある円周上のポイントを目標にする
                let futurePos = this.velocity.copy().normalize().mult(this.wanderDistance);
                futurePos.add(this.position);
                
                let wanderOffset = new Vector2D(
                    Math.cos(this.wanderAngle) * this.wanderRadius,
                    Math.sin(this.wanderAngle) * this.wanderRadius
                );
                
                let target = new Vector2D(futurePos.x + wanderOffset.x, futurePos.y + wanderOffset.y);
                
                return this.seek(target);
            }

            // 行動タイプに応じた特殊な動き
            specialBehavior() {
                let force = new Vector2D(0, 0);
                
                switch(this.behaviorType) {
                    case 'territorial': // 縄張り意識が強い - 一定範囲内に留まろうとする
                        const centerAttraction = 0.0003;
                        const toCenter = new Vector2D(mainCanvas.width / 2, mainCanvas.height / 2).sub(this.position);
                        if (toCenter.mag() > 300) {
                            force = toCenter.mult(centerAttraction);
                        }
                        break;
                        
                    case 'explorer': // 探索的 - 広範囲を移動
                        if (Math.random() < 0.01) { // 1%の確率で方向転換
                            force = new Vector2D(Math.random() * 2 - 1, Math.random() * 2 - 1).mult(0.5);
                        }
                        break;
                        
                    case 'darting': // 素早い動き - 急加速・急停止
                        if (Math.random() < 0.02) { // 2%の確率で急加速
                            force = this.velocity.copy().normalize().mult(0.8);
                        }
                        break;
                        
                    case 'graceful': // 優雅 - 滑らかな曲線を描く
                        const time = Date.now() * 0.001;
                        force = new Vector2D(
                            Math.sin(time + this.position.x * 0.01) * 0.05,
                            Math.cos(time + this.position.y * 0.01) * 0.05
                        );
                        break;
                        
                    case 'playful': // 遊び心がある - ランダムな動きが多い
                        if (Math.random() < 0.03) {
                            force = new Vector2D(
                                (Math.random() - 0.5) * 0.6,
                                (Math.random() - 0.5) * 0.6
                            );
                        }
                        break;
                }
                
                return force;
            }

            flock(boids, hands) {
                let sep = this.separation(boids);
                let ali = this.alignment(boids);
                let coh = this.cohesion(boids);
                let avoid = this.avoidHands(hands);
                let wand = this.wander();
                let special = this.specialBehavior();

                // 重み付け（分離を最優先）
                sep.mult(2.5); // 分離をさらに強化
                ali.mult(1.0);
                coh.mult(1.0);
                avoid.mult(3.0); // 手からの逃避を強く
                wand.mult(this.wanderStrength); // 種類ごとのランダムさ
                special.mult(1.0); // 特殊行動

                this.applyForce(sep);
                this.applyForce(ali);
                this.applyForce(coh);
                this.applyForce(avoid);
                this.applyForce(wand);
                this.applyForce(special);
            }

            update() {
                this.velocity.add(this.acceleration);
                this.velocity.limit(this.maxSpeed * this.speedVariation);
                this.position.add(this.velocity);
                this.acceleration.mult(0);

                // 画面端で折り返し
                if (this.position.x < 0) this.position.x = mainCanvas.width;
                if (this.position.x > mainCanvas.width) this.position.x = 0;
                if (this.position.y < 0) this.position.y = mainCanvas.height;
                if (this.position.y > mainCanvas.height) this.position.y = 0;
            }

            draw(ctx) {
                const angle = Math.atan2(this.velocity.y, this.velocity.x);
                
                ctx.save();
                ctx.translate(this.position.x, this.position.y);
                ctx.rotate(angle);
                
                // 魚の体
                ctx.fillStyle = `hsl(${this.hue}, ${this.saturation}%, ${this.lightness}%)`;
                ctx.beginPath();
                ctx.ellipse(0, 0, this.size, this.size * 0.5, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // 尾びれ
                ctx.fillStyle = `hsl(${this.hue}, ${this.saturation - 10}%, ${this.lightness - 10}%)`;
                ctx.beginPath();
                ctx.moveTo(-this.size, 0);
                ctx.lineTo(-this.size * 1.5, -this.size * 0.4);
                ctx.lineTo(-this.size * 1.5, this.size * 0.4);
                ctx.closePath();
                ctx.fill();
                
                // 目
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.arc(this.size * 0.5, -this.size * 0.2, this.size * 0.15, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = 'black';
                ctx.beginPath();
                ctx.arc(this.size * 0.5, -this.size * 0.2, this.size * 0.08, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.restore();
            }
        }

        // ボイド初期化
        function initBoids() {
            boids = [];
            
            // 各種類の魚を生成
            fishTypes.forEach(fishType => {
                for (let i = 0; i < fishType.schoolSize; i++) {
                    boids.push(new Boid(
                        Math.random() * mainCanvas.width,
                        Math.random() * mainCanvas.height,
                        fishType
                    ));
                }
            });
            
            fishCountElement.textContent = boids.length;
        }

        // 手の検出結果処理
        function onResults(results) {
            handPositions = [];

            if (results.multiHandLandmarks) {
                handStatusElement.textContent = `✅ (${results.multiHandLandmarks.length}手)`;
                
                for (const landmarks of results.multiHandLandmarks) {
                    // 手のひらの中心（ランドマーク0: 手首、9: 中指の付け根の中間）
                    const palm = landmarks[9];
                    
                    // ビデオ座標からメインキャンバス座標に変換（ミラーリング対応）
                    const x = (1 - palm.x) * mainCanvas.width;
                    const y = palm.y * mainCanvas.height;
                    
                    handPositions.push(new Vector2D(x, y));
                }
            } else {
                handStatusElement.textContent = '❌';
            }
        }

        // アニメーションループ
        function animate() {
            // 背景（水中効果）
            const gradient = mainCtx.createLinearGradient(0, 0, 0, mainCanvas.height);
            gradient.addColorStop(0, 'rgba(0, 30, 60, 0.3)');
            gradient.addColorStop(1, 'rgba(0, 50, 80, 0.3)');
            mainCtx.fillStyle = gradient;
            mainCtx.fillRect(0, 0, mainCanvas.width, mainCanvas.height);

            // 手の位置を描画
            handPositions.forEach(hand => {
                // 逃避範囲を可視化
                mainCtx.strokeStyle = 'rgba(255, 100, 100, 0.3)';
                mainCtx.lineWidth = 2;
                mainCtx.beginPath();
                mainCtx.arc(hand.x, hand.y, params.avoidRange, 0, Math.PI * 2);
                mainCtx.stroke();
                
                // 手のひらを描画
                mainCtx.fillStyle = 'rgba(255, 200, 150, 0.7)';
                mainCtx.beginPath();
                mainCtx.arc(hand.x, hand.y, 20, 0, Math.PI * 2);
                mainCtx.fill();
            });

            // ボイドの更新と描画
            boids.forEach(boid => {
                boid.flock(boids, handPositions);
                boid.update();
                boid.draw(mainCtx);
            });

            animationId = requestAnimationFrame(animate);
        }

        // 初期化
        async function init() {
            try {
                statusElement.textContent = 'カメラを起動中...';
                console.log('初期化開始...');

                // カメラ起動
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { 
                        width: { ideal: 640 },
                        height: { ideal: 480 },
                        facingMode: 'user'
                    }
                });
                
                video.srcObject = stream;
                
                await new Promise((resolve) => {
                    video.onloadedmetadata = () => {
                        video.play().then(() => {
                            console.log('ビデオ再生開始');
                            resolve();
                        });
                    };
                });

                statusElement.textContent = 'MediaPipeを初期化中...';
                console.log('MediaPipe Handsを初期化中...');

                // MediaPipe Handsの設定
                hands = new Hands({
                    locateFile: (file) => {
                        return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
                    }
                });

                hands.setOptions({
                    maxNumHands: 2,
                    modelComplexity: 1,
                    minDetectionConfidence: 0.5,
                    minTrackingConfidence: 0.5
                });

                hands.onResults(onResults);
                console.log('MediaPipe Hands初期化完了');

                // ボイド初期化
                initBoids();

                // アニメーション開始
                animate();
                console.log('アニメーションループ開始');

                // フレーム処理ループ
                async function processFrame() {
                    if (video.readyState === 4) {
                        try {
                            await hands.send({ image: video });
                        } catch (err) {
                            console.error('フレーム処理エラー:', err);
                        }
                    }
                    requestAnimationFrame(processFrame);
                }
                
                processFrame();
                
                statusElement.textContent = '✨ 手をかざして魚を動かしてください！';
                console.log('初期化完了！');

            } catch (error) {
                console.error('初期化エラー:', error);
                let errorMessage = 'エラー: ';
                
                if (error.name === 'NotAllowedError') {
                    errorMessage += 'カメラへのアクセスが拒否されました';
                } else if (error.name === 'NotFoundError') {
                    errorMessage += 'カメラが見つかりません';
                } else {
                    errorMessage += error.message;
                }
                
                statusElement.textContent = errorMessage;
            }
        }

        // 自動起動
        window.addEventListener('load', () => {
            console.log('ページ読み込み完了 - 自動起動');
            setTimeout(() => {
                init();
            }, 500);
        });
    </script>
</body>
</html>
