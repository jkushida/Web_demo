<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ハノイの塔</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 800px;
            width: 100%;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .controls button, .controls select {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        button {
            background: #667eea;
            color: white;
        }
        
        button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        select {
            background: white;
            border: 2px solid #667eea;
            color: #333;
        }
        
        .info {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .info-item {
            padding: 10px;
            background: #f7fafc;
            border-radius: 10px;
            min-width: 100px;
        }
        
        .info-label {
            font-size: 14px;
            color: #718096;
            margin-bottom: 5px;
        }
        
        .info-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        
        .game-area {
            position: relative;
            height: 300px;
            margin: 20px 0;
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
        }
        
        .base {
            position: absolute;
            bottom: 20px;
            height: 10px;
            width: 100%;
            background: #4a5568;
            border-radius: 5px;
        }
        
        .tower {
            position: absolute;
            bottom: 30px;
            width: 33.33%;
            height: 250px;
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
            cursor: pointer;
            transition: background 0.3s;
            border-radius: 10px;
        }
        
        .tower:hover {
            background: rgba(102, 126, 234, 0.1);
        }
        
        .tower.selected {
            background: rgba(102, 126, 234, 0.2);
        }
        
        .tower:nth-child(2) { left: 0; }
        .tower:nth-child(3) { left: 33.33%; }
        .tower:nth-child(4) { left: 66.66%; }
        
        .pole {
            position: absolute;
            width: 4px;
            height: 200px;
            background: #8B4513;
            left: 50%;
            transform: translateX(-50%);
            bottom: 30px;
            border-radius: 2px;
        }
        
        .disk {
            height: 30px;
            border-radius: 15px;
            margin: 2px 0;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .disk:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .disk.moving {
            animation: pulse 0.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .win-message {
            text-align: center;
            font-size: 24px;
            color: #48bb78;
            font-weight: bold;
            margin-top: 20px;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .instructions {
            background: #f7fafc;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .instructions h3 {
            color: #4a5568;
            margin-bottom: 10px;
        }
        
        .instructions p {
            color: #718096;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🗼 ハノイの塔 🗼</h1>
        
        <div class="controls">
            <select id="diskCount">
                <option value="3">3枚</option>
                <option value="4">4枚</option>
                <option value="5">5枚</option>
                <option value="6">6枚</option>
                <option value="7">7枚</option>
            </select>
            <button id="newGame">新しいゲーム</button>
            <button id="autoSolve">自動解決</button>
            <button id="reset">リセット</button>
        </div>
        
        <div class="info">
            <div class="info-item">
                <div class="info-label">移動回数</div>
                <div class="info-value" id="moves">0</div>
            </div>
            <div class="info-item">
                <div class="info-label">最小回数</div>
                <div class="info-value" id="minMoves">7</div>
            </div>
            <div class="info-item">
                <div class="info-label">経過時間</div>
                <div class="info-value" id="time">0:00</div>
            </div>
        </div>
        
        <div class="game-area">
            <div class="base"></div>
            <div class="tower" data-tower="0">
                <div class="pole"></div>
            </div>
            <div class="tower" data-tower="1">
                <div class="pole"></div>
            </div>
            <div class="tower" data-tower="2">
                <div class="pole"></div>
            </div>
        </div>
        
        <div id="message"></div>
        
        <div class="instructions">
            <h3>遊び方</h3>
            <p>
                <strong>【ゲームの目的】</strong><br>
                3本の棒があり、一番左の棒（出発用の棒）に積まれた円盤を、すべて一番右の棒（目標の棒）に移動させることが目的です。<br><br>
                
                <strong>【基本ルール】</strong><br>
                1. 円盤は1枚ずつしか動かせません。<br>
                2. 小さい円盤の上に大きい円盤を置くことはできません。<br>
                3. 真ん中の棒（作業用の棒）も自由に使えますが、そこでもルール2は守らなければなりません。<br>
                4. 最小手数は「2^n - 1」回（n=円盤の枚数）です。<br><br>
                
                <strong>【操作方法】</strong><br>
                <strong>◆ 手動で遊ぶ場合：</strong><br>
                1. 移動したい円盤がある塔をクリック（背景が薄紫色になり選択状態になります）<br>
                2. 移動先の塔をクリック（ルールに従って円盤が移動します）<br>
                3. 移動できない場合（大きい円盤を小さい円盤の上に置こうとした場合など）は何も起こりません<br>
                4. 選択を解除したい場合は、同じ塔をもう一度クリックします<br><br>
                
                <strong>◆ ゲームの開始方法：</strong><br>
                1. ブラウザで「hanoi.html」ファイルを開く<br>
                2. 上部のドロップダウンから円盤の枚数を選択（3〜7枚）<br>
                3. 「新しいゲーム」ボタンをクリックしてスタート<br>
                4. 左の塔から右の塔へ全ての円盤を移動させる<br><br>
                
                <strong>◆ 画面の見方：</strong><br>
                • 移動回数：現在までに円盤を動かした回数<br>
                • 最小回数：理論上の最小移動回数<br>
                • 経過時間：ゲーム開始からの時間<br>
                • 円盤の色：サイズごとに異なる色で表示<br>
                • 塔にマウスを乗せると薄く光ります<br><br>
                
                <strong>【機能説明】</strong><br>
                • <strong>枚数選択</strong>：3〜7枚から難易度を選べます<br>
                • <strong>新しいゲーム</strong>：最初からやり直します<br>
                • <strong>自動解決</strong>：コンピュータが最適解を実演します<br>
                • <strong>リセット</strong>：現在の設定で最初に戻します<br><br>
                
                <strong>【攻略のヒント】</strong><br>
                • 奇数枚：最初の一手は右の塔へ<br>
                • 偶数枚：最初の一手は中央の塔へ<br>
                • 小さい円盤を頻繁に動かすことがコツです
            </p>
        </div>
    </div>
    
    <script>
        class HanoiGame {
            constructor() {
                this.towers = [[], [], []];
                this.moves = 0;
                this.selectedTower = null;
                this.diskCount = 3;
                this.startTime = null;
                this.timerInterval = null;
                this.isAutoSolving = false;
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.newGame();
            }
            
            setupEventListeners() {
                document.getElementById('newGame').addEventListener('click', () => this.newGame());
                document.getElementById('reset').addEventListener('click', () => this.reset());
                document.getElementById('autoSolve').addEventListener('click', () => this.autoSolve());
                document.getElementById('diskCount').addEventListener('change', (e) => {
                    this.diskCount = parseInt(e.target.value);
                    this.newGame();
                });
                
                document.querySelectorAll('.tower').forEach(tower => {
                    tower.addEventListener('click', (e) => {
                        if (!this.isAutoSolving) {
                            const towerIndex = parseInt(tower.dataset.tower);
                            this.handleTowerClick(towerIndex);
                        }
                    });
                });
            }
            
            newGame() {
                this.towers = [[], [], []];
                this.moves = 0;
                this.selectedTower = null;
                this.isAutoSolving = false;
                
                for (let i = this.diskCount; i > 0; i--) {
                    this.towers[0].push(i);
                }
                
                this.updateDisplay();
                this.updateMinMoves();
                this.startTimer();
                document.getElementById('message').innerHTML = '';
                document.getElementById('autoSolve').disabled = false;
            }
            
            reset() {
                this.newGame();
            }
            
            startTimer() {
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                }
                this.startTime = Date.now();
                this.timerInterval = setInterval(() => {
                    const elapsed = Math.floor((Date.now() - this.startTime) / 1000);
                    const minutes = Math.floor(elapsed / 60);
                    const seconds = elapsed % 60;
                    document.getElementById('time').textContent = 
                        `${minutes}:${seconds.toString().padStart(2, '0')}`;
                }, 1000);
            }
            
            handleTowerClick(towerIndex) {
                if (this.selectedTower === null) {
                    if (this.towers[towerIndex].length > 0) {
                        this.selectedTower = towerIndex;
                        document.querySelectorAll('.tower')[towerIndex].classList.add('selected');
                    }
                } else {
                    if (this.canMove(this.selectedTower, towerIndex)) {
                        this.moveDisk(this.selectedTower, towerIndex);
                        this.moves++;
                        this.updateDisplay();
                        
                        if (this.checkWin()) {
                            this.handleWin();
                        }
                    }
                    document.querySelectorAll('.tower').forEach(t => t.classList.remove('selected'));
                    this.selectedTower = null;
                }
            }
            
            canMove(from, to) {
                if (from === to) return false;
                if (this.towers[from].length === 0) return false;
                if (this.towers[to].length === 0) return true;
                return this.towers[from][this.towers[from].length - 1] < 
                       this.towers[to][this.towers[to].length - 1];
            }
            
            moveDisk(from, to) {
                const disk = this.towers[from].pop();
                this.towers[to].push(disk);
            }
            
            checkWin() {
                return this.towers[2].length === this.diskCount;
            }
            
            handleWin() {
                clearInterval(this.timerInterval);
                const minMoves = Math.pow(2, this.diskCount) - 1;
                const efficiency = Math.round((minMoves / this.moves) * 100);
                document.getElementById('message').innerHTML = 
                    `<div class="win-message">
                        🎉 おめでとうございます！ 🎉<br>
                        ${this.moves}回で完成しました！<br>
                        効率: ${efficiency}%
                    </div>`;
            }
            
            updateDisplay() {
                document.getElementById('moves').textContent = this.moves;
                
                document.querySelectorAll('.tower').forEach((towerEl, towerIndex) => {
                    const disks = towerEl.querySelectorAll('.disk');
                    disks.forEach(disk => disk.remove());
                    
                    this.towers[towerIndex].forEach(diskSize => {
                        const disk = document.createElement('div');
                        disk.className = 'disk';
                        disk.style.width = `${diskSize * 30 + 40}px`;
                        disk.style.background = this.getDiskColor(diskSize);
                        towerEl.appendChild(disk);
                    });
                });
            }
            
            getDiskColor(size) {
                const colors = [
                    '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', 
                    '#FFEAA7', '#DDA0DD', '#98D8C8', '#F7DC6F'
                ];
                return colors[size - 1] || '#667eea';
            }
            
            updateMinMoves() {
                const minMoves = Math.pow(2, this.diskCount) - 1;
                document.getElementById('minMoves').textContent = minMoves;
            }
            
            async autoSolve() {
                if (this.isAutoSolving) return;
                
                this.isAutoSolving = true;
                document.getElementById('autoSolve').disabled = true;
                this.newGame();
                
                await this.sleep(500);
                await this.solveHanoi(this.diskCount, 0, 2, 1);
                
                this.isAutoSolving = false;
                this.handleWin();
            }
            
            async solveHanoi(n, from, to, aux) {
                if (n === 1) {
                    if (this.canMove(from, to)) {
                        this.moveDisk(from, to);
                        this.moves++;
                        this.updateDisplay();
                        await this.sleep(300);
                    }
                    return;
                }
                
                await this.solveHanoi(n - 1, from, aux, to);
                await this.solveHanoi(1, from, to, aux);
                await this.solveHanoi(n - 1, aux, to, from);
            }
            
            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }
        
        new HanoiGame();
    </script>
</body>
</html>