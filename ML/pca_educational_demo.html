<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼‰æ•™è‚²ãƒ‡ãƒ¢ - è¨ˆç®—éç¨‹ã®å¯è¦–åŒ–</title>
    <script src="https://cdn.jsdelivr.net/npm/plotly.js@2.27.0/dist/plotly.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            max-width: 1600px;
            margin: 0 auto;
            padding: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        h1 {
            color: #333;
            text-align: center;
            font-size: 24px;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: 14px;
        }
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        label {
            font-weight: bold;
            color: #555;
            font-size: 12px;
        }
        input[type="range"] {
            width: 150px;
        }
        .value-display {
            text-align: center;
            color: #667eea;
            font-weight: bold;
            font-size: 12px;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            transform: translateY(-2px);
        }
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }
        .plot-container {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
        }
        .math-container {
            grid-column: span 3;
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .step-container {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .step-header {
            background: #667eea;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            margin-bottom: 10px;
            font-weight: bold;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            font-size: 12px;
        }
        th, td {
            padding: 8px;
            text-align: center;
            border: 1px solid #ddd;
        }
        th {
            background: #667eea;
            color: white;
        }
        .matrix {
            display: inline-block;
            margin: 10px;
            padding: 10px;
            border: 2px solid #667eea;
            border-radius: 5px;
            background: white;
        }
        .matrix-title {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        .highlight {
            background: #ffeb3b;
            padding: 2px 5px;
            border-radius: 3px;
        }
        .equation {
            font-size: 14px;
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
        }
        h2 {
            color: #555;
            font-size: 18px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
            margin: 15px 0 10px 0;
        }
        .info-box {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š ä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼‰- è¨ˆç®—éç¨‹ã®å¯è¦–åŒ–</h1>
        <p class="subtitle">å›ºæœ‰å€¤ãƒ»å›ºæœ‰ãƒ™ã‚¯ãƒˆãƒ«ã®è¨ˆç®—æ‰‹é †ã‚’ç†è§£ã—ã‚ˆã†</p>
        
        <div class="info-box">
            <strong>PCAã®æ‰‹é †ï¼š</strong>
            1ï¸âƒ£ ãƒ‡ãƒ¼ã‚¿ã®ä¸­å¿ƒåŒ– â†’ 2ï¸âƒ£ å…±åˆ†æ•£è¡Œåˆ—ã®è¨ˆç®— â†’ 3ï¸âƒ£ å›ºæœ‰å€¤ãƒ»å›ºæœ‰ãƒ™ã‚¯ãƒˆãƒ«ã®è¨ˆç®— â†’ 4ï¸âƒ£ ä¸»æˆåˆ†ã¸ã®å°„å½±
        </div>

        <div class="controls">
            <div class="control-group">
                <label>ãƒ‡ãƒ¼ã‚¿ç‚¹æ•°:</label>
                <input type="range" id="nPoints" min="20" max="100" value="50" step="5">
                <div class="value-display" id="nPointsValue">50</div>
            </div>
            <div class="control-group">
                <label>ç›¸é–¢ä¿‚æ•°:</label>
                <input type="range" id="correlation" min="-0.9" max="0.9" value="0.7" step="0.1">
                <div class="value-display" id="correlationValue">0.7</div>
            </div>
            <div class="control-group">
                <label>Xè»¸ã®åˆ†æ•£:</label>
                <input type="range" id="xVar" min="0.5" max="2" value="1.5" step="0.1">
                <div class="value-display" id="xVarianceValue">1.5</div>
            </div>
            <div class="control-group">
                <label>Yè»¸ã®åˆ†æ•£:</label>
                <input type="range" id="yVar" min="0.5" max="2" value="1" step="0.1">
                <div class="value-display" id="yVarianceValue">1.0</div>
            </div>
            <button onclick="generateAndAnalyze()">ğŸ”„ ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã¨åˆ†æå®Ÿè¡Œ</button>
        </div>

        <h2>Step 1: å…ƒãƒ‡ãƒ¼ã‚¿ã¨ä¸­å¿ƒåŒ–</h2>
        <div class="info-box" style="margin-bottom: 10px;">
            <strong>ä¸­å¿ƒåŒ–ã¨ã¯ï¼š</strong> å„ãƒ‡ãƒ¼ã‚¿ç‚¹ã‹ã‚‰å¹³å‡ã‚’å¼•ã„ã¦ã€ãƒ‡ãƒ¼ã‚¿ã®é‡å¿ƒã‚’åŸç‚¹ã«ç§»å‹•ã•ã›ã‚‹æ“ä½œ<br>
            <strong>è¨ˆç®—å¼ï¼š</strong> $$x'_i = x_i - \mu_x, \quad y'_i = y_i - \mu_y$$
            <span style="color: #666;">â†’ ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ‡ãƒ¼ã‚¿ã®ã€Œå½¢ã€ã¯ãã®ã¾ã¾ã§ã€ä½ç½®ã ã‘ãŒåŸç‚¹ä¸­å¿ƒã«ç§»å‹•ã—ã¾ã™</span>
        </div>
        <div class="main-grid">
            <div class="plot-container">
                <div id="originalPlot"></div>
            </div>
            <div class="plot-container">
                <div id="centeredPlot"></div>
            </div>
            <div class="plot-container">
                <div id="pcaPlot"></div>
            </div>
        </div>

        <h2>Step 2: å…±åˆ†æ•£è¡Œåˆ—ã¨å›ºæœ‰å€¤ãƒ»å›ºæœ‰ãƒ™ã‚¯ãƒˆãƒ«</h2>
        <div class="step-container">
            <div class="step-header">å…±åˆ†æ•£è¡Œåˆ— C</div>
            <div id="covarianceMatrix"></div>
            
            <div class="step-header" style="margin-top: 15px;">å›ºæœ‰å€¤ã¨å›ºæœ‰ãƒ™ã‚¯ãƒˆãƒ«</div>
            <div id="eigenAnalysis"></div>
            
            <div class="equation">
                <strong>å›ºæœ‰æ–¹ç¨‹å¼ï¼š</strong> \(C\vec{v} = \lambda\vec{v}\)<br>
                <span style="font-size: 12px;">ã“ã“ã§ã€C: å…±åˆ†æ•£è¡Œåˆ—ã€Î»: å›ºæœ‰å€¤ã€v: å›ºæœ‰ãƒ™ã‚¯ãƒˆãƒ«</span>
            </div>
        </div>

        <h2>Step 3: ä¸»æˆåˆ†ã¸ã®å°„å½±</h2>
        <div class="main-grid">
            <div class="plot-container">
                <div id="projectionPlot"></div>
            </div>
            <div class="plot-container">
                <div id="transformedPlot"></div>
            </div>
            <div class="plot-container">
                <div id="variancePlot"></div>
            </div>
        </div>

        <h2>åˆ†æçµæœã®ã¾ã¨ã‚</h2>
        <div class="step-container">
            <table id="resultTable">
                <tr>
                    <th>ä¸»æˆåˆ†</th>
                    <th>å›ºæœ‰å€¤</th>
                    <th>å¯„ä¸ç‡(%)</th>
                    <th>ç´¯ç©å¯„ä¸ç‡(%)</th>
                    <th>å›ºæœ‰ãƒ™ã‚¯ãƒˆãƒ«</th>
                </tr>
            </table>
            
            <div class="info-box" style="margin-top: 15px;">
                <strong>è§£é‡ˆï¼š</strong>
                <div id="interpretation"></div>
            </div>
        </div>
    </div>

    <script>
        // MathJaxè¨­å®š
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            }
        };

        // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ
        document.getElementById('nPoints').addEventListener('input', function() {
            document.getElementById('nPointsValue').textContent = this.value;
        });
        document.getElementById('correlation').addEventListener('input', function() {
            document.getElementById('correlationValue').textContent = this.value;
        });
        document.getElementById('xVar').addEventListener('input', function() {
            document.getElementById('xVarianceValue').textContent = this.value;
        });
        document.getElementById('yVar').addEventListener('input', function() {
            document.getElementById('yVarianceValue').textContent = this.value;
        });

        let originalData = [];
        let centeredData = [];
        let covMatrix = [];
        let eigenvalues = [];
        let eigenvectors = [];
        let transformedData = [];
        let mean = [0, 0];

        function generateAndAnalyze() {
            const n = parseInt(document.getElementById('nPoints').value);
            const corr = parseFloat(document.getElementById('correlation').value);
            const xVar = parseFloat(document.getElementById('xVar').value);
            const yVar = parseFloat(document.getElementById('yVar').value);

            // ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
            originalData = generateCorrelatedData(n, corr, xVar, yVar);
            
            // PCAå®Ÿè¡Œ
            performPCA();
            
            // å…¨ãƒ—ãƒ­ãƒƒãƒˆæ›´æ–°
            plotOriginalData();
            plotCenteredData();
            plotPCAResult();
            plotProjection();
            plotTransformed();
            plotVariance();
            displayMatrices();
            updateResultTable();
            
            // MathJaxã§æ•°å¼ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼ˆå°‘ã—é…å»¶ã•ã›ã‚‹ï¼‰
            setTimeout(() => {
                if (window.MathJax && window.MathJax.typeset) {
                    MathJax.typeset();
                } else if (window.MathJax && window.MathJax.Hub) {
                    MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
                }
            }, 100);
        }

        function generateCorrelatedData(n, correlation, xVar, yVar) {
            const data = [];
            // åŸç‚¹ã‹ã‚‰é›¢ã‚ŒãŸä½ç½®ã«ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼ˆä¸­å¿ƒåŒ–ã®åŠ¹æœã‚’è¦‹ã‚„ã™ãã™ã‚‹ãŸã‚ï¼‰
            const xOffset = 3.5;
            const yOffset = 2.5;
            
            for (let i = 0; i < n; i++) {
                const z1 = gaussianRandom() * Math.sqrt(xVar);
                const z2 = gaussianRandom() * Math.sqrt(yVar);
                const x = z1 + xOffset;
                const y = correlation * z1 + Math.sqrt(1 - correlation * correlation) * z2 + yOffset;
                data.push([x, y]);
            }
            return data;
        }

        function gaussianRandom() {
            let u = 0, v = 0;
            while (u === 0) u = Math.random();
            while (v === 0) v = Math.random();
            return Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
        }

        function performPCA() {
            // Step 1: ä¸­å¿ƒåŒ–
            mean[0] = originalData.reduce((sum, d) => sum + d[0], 0) / originalData.length;
            mean[1] = originalData.reduce((sum, d) => sum + d[1], 0) / originalData.length;
            
            centeredData = originalData.map(d => [d[0] - mean[0], d[1] - mean[1]]);

            // Step 2: å…±åˆ†æ•£è¡Œåˆ—
            const n = centeredData.length;
            covMatrix = [[0, 0], [0, 0]];
            
            for (let i = 0; i < n; i++) {
                covMatrix[0][0] += centeredData[i][0] * centeredData[i][0];
                covMatrix[0][1] += centeredData[i][0] * centeredData[i][1];
                covMatrix[1][0] += centeredData[i][1] * centeredData[i][0];
                covMatrix[1][1] += centeredData[i][1] * centeredData[i][1];
            }
            
            for (let i = 0; i < 2; i++) {
                for (let j = 0; j < 2; j++) {
                    covMatrix[i][j] /= (n - 1);
                }
            }

            // Step 3: å›ºæœ‰å€¤ã¨å›ºæœ‰ãƒ™ã‚¯ãƒˆãƒ«ï¼ˆ2x2ã®è§£æè§£ï¼‰
            const a = covMatrix[0][0];
            const b = covMatrix[0][1];
            const c = covMatrix[1][0];
            const d = covMatrix[1][1];
            
            const trace = a + d;
            const det = a * d - b * c;
            const discriminant = Math.sqrt(trace * trace - 4 * det);
            
            eigenvalues[0] = (trace + discriminant) / 2;
            eigenvalues[1] = (trace - discriminant) / 2;
            
            if (b !== 0) {
                eigenvectors[0] = [b, eigenvalues[0] - a];
                eigenvectors[1] = [b, eigenvalues[1] - a];
            } else if (c !== 0) {
                eigenvectors[0] = [eigenvalues[0] - d, c];
                eigenvectors[1] = [eigenvalues[1] - d, c];
            } else {
                eigenvectors[0] = [1, 0];
                eigenvectors[1] = [0, 1];
            }
            
            // æ­£è¦åŒ–
            for (let i = 0; i < 2; i++) {
                const norm = Math.sqrt(eigenvectors[i][0] ** 2 + eigenvectors[i][1] ** 2);
                eigenvectors[i][0] /= norm;
                eigenvectors[i][1] /= norm;
            }

            // Step 4: å¤‰æ›
            transformedData = centeredData.map(d => [
                d[0] * eigenvectors[0][0] + d[1] * eigenvectors[0][1],
                d[0] * eigenvectors[1][0] + d[1] * eigenvectors[1][1]
            ]);
        }

        function plotOriginalData() {
            const x = originalData.map(d => d[0]);
            const y = originalData.map(d => d[1]);
            
            const traces = [
                {
                    x: x,
                    y: y,
                    mode: 'markers',
                    type: 'scatter',
                    marker: { size: 6, color: 'rgba(102, 126, 234, 0.7)' },
                    name: 'ãƒ‡ãƒ¼ã‚¿ç‚¹'
                },
                // å¹³å‡ç‚¹ã‚’è¿½åŠ 
                {
                    x: [mean[0]],
                    y: [mean[1]],
                    mode: 'markers',
                    type: 'scatter',
                    marker: { 
                        size: 12, 
                        color: 'red',
                        symbol: 'x'
                    },
                    name: 'å¹³å‡'
                }
            ];
            
            const layout = {
                title: 'å…ƒãƒ‡ãƒ¼ã‚¿',
                xaxis: { title: 'X', zeroline: true, range: [-1, 7] },
                yaxis: { title: 'Y', zeroline: true, scaleanchor: 'x', range: [-1, 6] },
                height: 320,
                width: 320,
                margin: { l: 40, r: 20, t: 60, b: 40 },
                showlegend: true,
                legend: {
                    orientation: 'h',
                    x: 0.5,
                    xanchor: 'center',
                    y: 1.12,
                    yanchor: 'top',
                    font: { size: 11 }
                }
            };
            
            Plotly.newPlot('originalPlot', traces, layout);
        }

        function plotCenteredData() {
            const x = centeredData.map(d => d[0]);
            const y = centeredData.map(d => d[1]);
            
            const traces = [
                {
                    x: x,
                    y: y,
                    mode: 'markers',
                    type: 'scatter',
                    marker: { size: 6, color: 'rgba(118, 75, 162, 0.7)' },
                    name: 'ä¸­å¿ƒåŒ–ãƒ‡ãƒ¼ã‚¿',
                    showlegend: false
                },
                // åŸç‚¹ã‚’å¼·èª¿
                {
                    x: [0],
                    y: [0],
                    mode: 'markers',
                    type: 'scatter',
                    marker: { 
                        size: 12, 
                        color: 'red',
                        symbol: 'x'
                    },
                    name: 'ä¸­å¿ƒ'
                }
            ];
            
            const layout = {
                title: 'ä¸­å¿ƒåŒ–å¾Œ',
                xaxis: { title: 'X - Î¼â‚“', zeroline: true, zerolinewidth: 2, zerolinecolor: 'red' },
                yaxis: { title: 'Y - Î¼áµ§', zeroline: true, zerolinewidth: 2, zerolinecolor: 'red', scaleanchor: 'x' },
                height: 320,
                width: 320,
                margin: { l: 40, r: 20, t: 60, b: 40 },
                showlegend: true,
                legend: {
                    orientation: 'h',
                    x: 0.5,
                    xanchor: 'center',
                    y: 1.12,
                    yanchor: 'top',
                    font: { size: 11 }
                }
            };
            
            Plotly.newPlot('centeredPlot', traces, layout);
        }

        function plotPCAResult() {
            const x = centeredData.map(d => d[0]);
            const y = centeredData.map(d => d[1]);
            
            const scale = Math.sqrt(eigenvalues[0]) * 2;
            const scale2 = Math.sqrt(eigenvalues[1]) * 2;
            
            const traces = [
                {
                    x: x,
                    y: y,
                    mode: 'markers',
                    type: 'scatter',
                    marker: { size: 6, color: 'rgba(102, 126, 234, 0.5)' },
                    name: 'ãƒ‡ãƒ¼ã‚¿',
                    showlegend: false
                },
                {
                    x: [0, eigenvectors[0][0] * scale],
                    y: [0, eigenvectors[0][1] * scale],
                    mode: 'lines+markers',
                    type: 'scatter',
                    line: { color: 'red', width: 3 },
                    marker: { size: 8, color: 'red' },
                    name: 'PC1'
                },
                {
                    x: [0, eigenvectors[1][0] * scale2],
                    y: [0, eigenvectors[1][1] * scale2],
                    mode: 'lines+markers',
                    type: 'scatter',
                    line: { color: 'green', width: 3 },
                    marker: { size: 8, color: 'green' },
                    name: 'PC2'
                }
            ];
            
            const layout = {
                title: 'ä¸»æˆåˆ†ãƒ™ã‚¯ãƒˆãƒ«',
                xaxis: { title: 'X', zeroline: true },
                yaxis: { title: 'Y', zeroline: true, scaleanchor: 'x' },
                height: 320,
                width: 320,
                margin: { l: 40, r: 20, t: 60, b: 40 },
                showlegend: true,
                legend: {
                    orientation: 'h',
                    x: 0.5,
                    xanchor: 'center',
                    y: 1.12,
                    yanchor: 'top',
                    font: { size: 11 },
                    itemsizing: 'constant',
                    itemwidth: 30,
                    traceorder: 'normal'
                }
            };
            
            Plotly.newPlot('pcaPlot', traces, layout);
        }

        function plotProjection() {
            const x = centeredData.map(d => d[0]);
            const y = centeredData.map(d => d[1]);
            
            // PC1ã¸ã®å°„å½±ã‚’è¨ˆç®—
            const projections = centeredData.map(d => {
                const proj = (d[0] * eigenvectors[0][0] + d[1] * eigenvectors[0][1]);
                return [proj * eigenvectors[0][0], proj * eigenvectors[0][1]];
            });
            
            const traces = [
                {
                    x: x,
                    y: y,
                    mode: 'markers',
                    type: 'scatter',
                    marker: { size: 6, color: 'rgba(102, 126, 234, 0.5)' },
                    name: 'ãƒ‡ãƒ¼ã‚¿'
                }
            ];
            
            // å°„å½±ç·šã‚’è¿½åŠ 
            for (let i = 0; i < Math.min(10, centeredData.length); i++) {
                traces.push({
                    x: [centeredData[i][0], projections[i][0]],
                    y: [centeredData[i][1], projections[i][1]],
                    mode: 'lines',
                    type: 'scatter',
                    line: { color: 'orange', width: 1, dash: 'dash' },
                    showlegend: false
                });
            }
            
            // å°„å½±ç‚¹
            traces.push({
                x: projections.slice(0, 10).map(p => p[0]),
                y: projections.slice(0, 10).map(p => p[1]),
                mode: 'markers',
                type: 'scatter',
                marker: { size: 8, color: 'orange' },
                name: 'PC1ã¸ã®å°„å½±'
            });
            
            const layout = {
                title: 'PC1ã¸ã®å°„å½±',
                xaxis: { title: 'X', zeroline: true },
                yaxis: { title: 'Y', zeroline: true, scaleanchor: 'x' },
                height: 320,
                width: 320,
                margin: { l: 40, r: 20, t: 60, b: 40 },
                showlegend: true,
                legend: {
                    orientation: 'h',
                    x: 0.5,
                    xanchor: 'center',
                    y: 1.12,
                    yanchor: 'top',
                    font: { size: 11 }
                }
            };
            
            Plotly.newPlot('projectionPlot', traces, layout);
        }

        function plotTransformed() {
            const x = transformedData.map(d => d[0]);
            const y = transformedData.map(d => d[1]);
            
            const trace = {
                x: x,
                y: y,
                mode: 'markers',
                type: 'scatter',
                marker: { size: 6, color: 'rgba(255, 107, 107, 0.7)' },
                name: 'å¤‰æ›å¾Œãƒ‡ãƒ¼ã‚¿'
            };
            
            const layout = {
                title: 'ä¸»æˆåˆ†åº§æ¨™ç³»',
                xaxis: { title: 'PC1', zeroline: true },
                yaxis: { title: 'PC2', zeroline: true, scaleanchor: 'x' },
                height: 320,
                width: 320,
                margin: { l: 40, r: 20, t: 60, b: 40 },
                showlegend: true,
                legend: {
                    orientation: 'h',
                    x: 0.5,
                    xanchor: 'center',
                    y: 1.12,
                    yanchor: 'top',
                    font: { size: 11 }
                }
            };
            
            Plotly.newPlot('transformedPlot', [trace], layout);
        }

        function plotVariance() {
            const contribution1 = eigenvalues[0] / (eigenvalues[0] + eigenvalues[1]) * 100;
            const contribution2 = eigenvalues[1] / (eigenvalues[0] + eigenvalues[1]) * 100;
            
            const trace = {
                x: ['PC1', 'PC2'],
                y: [contribution1, contribution2],
                type: 'bar',
                marker: {
                    color: ['rgba(255, 107, 107, 0.8)', 'rgba(107, 255, 107, 0.8)']
                },
                text: [contribution1.toFixed(1) + '%', contribution2.toFixed(1) + '%'],
                textposition: 'auto'
            };
            
            const layout = {
                title: 'å¯„ä¸ç‡',
                yaxis: { title: 'å¯„ä¸ç‡ (%)', range: [0, 100] },
                height: 300,
                margin: { l: 40, r: 20, t: 60, b: 40 }
            };
            
            Plotly.newPlot('variancePlot', [trace], layout);
        }

        function displayMatrices() {
            // å…±åˆ†æ•£è¡Œåˆ—ã®è¡¨ç¤º
            let covHtml = '<div style="display: flex; gap: 30px; align-items: flex-start;">';
            
            // å·¦å´ï¼šå…±åˆ†æ•£è¡Œåˆ—
            covHtml += '<div>';
            covHtml += '<table style="display: inline-block; margin: 10px;">';
            covHtml += '<tr><td style="background: #e3f2fd;">C =</td>';
            covHtml += `<td>[${covMatrix[0][0].toFixed(3)}</td><td>${covMatrix[0][1].toFixed(3)}]</td></tr>`;
            covHtml += `<tr><td></td><td>[${covMatrix[1][0].toFixed(3)}</td><td>${covMatrix[1][1].toFixed(3)}]</td></tr>`;
            covHtml += '</table>';
            covHtml += '</div>';
            
            // å³å´ï¼šå„æˆåˆ†ã®æ±‚ã‚æ–¹
            covHtml += '<div style="flex: 1; padding: 15px; background: #fff9c4; border-radius: 5px; font-size: 14px;">';
            covHtml += '<strong>å…±åˆ†æ•£è¡Œåˆ—ã®å„æˆåˆ†ï¼š</strong><br><br>';
            covHtml += '$$C_{00} = \\text{Var}(X) = \\frac{1}{n-1}\\sum_{i=1}^{n}(x_i - \\bar{x})^2$$';
            covHtml += '$$C_{11} = \\text{Var}(Y) = \\frac{1}{n-1}\\sum_{i=1}^{n}(y_i - \\bar{y})^2$$';
            covHtml += '$$C_{01} = C_{10} = \\text{Cov}(X,Y) = \\frac{1}{n-1}\\sum_{i=1}^{n}(x_i - \\bar{x})(y_i - \\bar{y})$$';
            covHtml += '</div>';
            
            covHtml += '</div>';
            
            document.getElementById('covarianceMatrix').innerHTML = covHtml;
            
            // å›ºæœ‰å€¤ã¨å›ºæœ‰ãƒ™ã‚¯ãƒˆãƒ«ã®è¡¨ç¤º
            let eigenHtml = '<div style="display: flex; gap: 20px; flex-wrap: wrap;">';
            
            eigenHtml += '<div class="matrix">';
            eigenHtml += '<div class="matrix-title">å›ºæœ‰å€¤</div>';
            eigenHtml += `<div>Î»â‚ = <span class="highlight">${eigenvalues[0].toFixed(4)}</span></div>`;
            eigenHtml += `<div>Î»â‚‚ = <span class="highlight">${eigenvalues[1].toFixed(4)}</span></div>`;
            eigenHtml += '</div>';
            
            eigenHtml += '<div class="matrix">';
            eigenHtml += '<div class="matrix-title">ç¬¬1ä¸»æˆåˆ†ï¼ˆå›ºæœ‰ãƒ™ã‚¯ãƒˆãƒ«ï¼‰</div>';
            eigenHtml += `<div>vâ‚ = [${eigenvectors[0][0].toFixed(3)}, ${eigenvectors[0][1].toFixed(3)}]áµ€</div>`;
            eigenHtml += '</div>';
            
            eigenHtml += '<div class="matrix">';
            eigenHtml += '<div class="matrix-title">ç¬¬2ä¸»æˆåˆ†ï¼ˆå›ºæœ‰ãƒ™ã‚¯ãƒˆãƒ«ï¼‰</div>';
            eigenHtml += `<div>vâ‚‚ = [${eigenvectors[1][0].toFixed(3)}, ${eigenvectors[1][1].toFixed(3)}]áµ€</div>`;
            eigenHtml += '</div>';
            
            eigenHtml += '</div>';
            
            // å›ºæœ‰å€¤ã®æ±‚ã‚æ–¹ã‚’è¿½åŠ 
            eigenHtml += '<div style="margin-top: 15px; padding: 12px; background: #fff9c4; border-radius: 5px; font-size: 13px; line-height: 1.4;">';
            eigenHtml += '<strong>å›ºæœ‰å€¤ã®æ±‚ã‚æ–¹ï¼ˆè©³ç´°ãªå°å‡ºï¼‰ï¼š</strong><br><br>';
            
            eigenHtml += '<div style="margin-bottom: 12px;">';
            eigenHtml += '<strong>1. å›ºæœ‰å€¤å•é¡Œï¼š</strong> $C\\mathbf{v} = \\lambda\\mathbf{v}$<br>';
            eigenHtml += '<strong>2. å¤‰å½¢ï¼š</strong> $(C - \\lambda I)\\mathbf{v} = \\mathbf{0}$<br>';
            eigenHtml += '<strong>3. éè‡ªæ˜è§£ã®æ¡ä»¶ï¼š</strong> $\\det(C - \\lambda I) = 0$ ï¼ˆç‰¹æ€§æ–¹ç¨‹å¼ï¼‰';
            eigenHtml += '</div>';
            
            eigenHtml += '<div style="margin-bottom: 12px;">';
            eigenHtml += '<strong>4. 2Ã—2è¡Œåˆ—ã®å ´åˆï¼š</strong><br>';
            const a11 = covMatrix[0][0].toFixed(3);
            const a12 = covMatrix[0][1].toFixed(3);
            const a21 = covMatrix[1][0].toFixed(3);
            const a22 = covMatrix[1][1].toFixed(3);
            eigenHtml += `$C = \\begin{pmatrix} ${a11} & ${a12} \\\\ ${a21} & ${a22} \\end{pmatrix}$ ã«å¯¾ã—ã¦ï¼š`;
            eigenHtml += `$C - \\lambda I = \\begin{pmatrix} ${a11} - \\lambda & ${a12} \\\\ ${a21} & ${a22} - \\lambda \\end{pmatrix}$`;
            eigenHtml += '</div>';
            
            eigenHtml += '<div style="margin-bottom: 12px;">';
            eigenHtml += '<strong>5. è¡Œåˆ—å¼ã®è¨ˆç®—ï¼š</strong><br>';
            eigenHtml += `$\\det(C - \\lambda I) = (${a11} - \\lambda)(${a22} - \\lambda) - (${a12})(${a21})$<br>`;
            const trace = covMatrix[0][0] + covMatrix[1][1];
            const det = covMatrix[0][0] * covMatrix[1][1] - covMatrix[0][1] * covMatrix[1][0];
            eigenHtml += `$= \\lambda^2 - ${trace.toFixed(3)}\\lambda + ${det.toFixed(3)} = 0$`;
            eigenHtml += '</div>';
            
            eigenHtml += '<div>';
            eigenHtml += '<strong>6. è§£ï¼ˆå›ºæœ‰å€¤ï¼‰ï¼š</strong> ';
            eigenHtml += `$\\lambda_1 = ${eigenvalues[0].toFixed(3)}, \\; \\lambda_2 = ${eigenvalues[1].toFixed(3)}$`;
            eigenHtml += '</div>';
            
            eigenHtml += '</div>';
            
            // ä¸»æˆåˆ†ãƒ™ã‚¯ãƒˆãƒ«ã¨å›ºæœ‰å€¤ã®é–¢ä¿‚ã‚’è¿½åŠ 
            eigenHtml += '<div style="margin-top: 15px; padding: 15px; background: #e8f5e9; border-radius: 5px; font-size: 14px;">';
            eigenHtml += '<strong>ä¸»æˆåˆ†ãƒ™ã‚¯ãƒˆãƒ«ã¨å›ºæœ‰å€¤ã®é–¢ä¿‚ï¼š</strong><br><br>';
            eigenHtml += '<div style="margin-bottom: 10px;">ğŸ“ <strong>å›ºæœ‰ãƒ™ã‚¯ãƒˆãƒ« = ä¸»æˆåˆ†ã®æ–¹å‘</strong></div>';
            eigenHtml += '<ul style="margin-left: 20px;">';
            eigenHtml += '<li>ç¬¬1ä¸»æˆåˆ†ãƒ™ã‚¯ãƒˆãƒ«ï¼ˆvâ‚ï¼‰: ãƒ‡ãƒ¼ã‚¿ã®åˆ†æ•£ãŒ<strong>æœ€å¤§</strong>ã¨ãªã‚‹æ–¹å‘</li>';
            eigenHtml += '<li>ç¬¬2ä¸»æˆåˆ†ãƒ™ã‚¯ãƒˆãƒ«ï¼ˆvâ‚‚ï¼‰: vâ‚ã¨<strong>ç›´äº¤</strong>ã—ã€æ®‹ã‚Šã®åˆ†æ•£ãŒæœ€å¤§ã¨ãªã‚‹æ–¹å‘</li>';
            eigenHtml += '</ul>';
            eigenHtml += '<br>';
            eigenHtml += '<div style="margin-bottom: 10px;">ğŸ“ <strong>å›ºæœ‰å€¤ = å„ä¸»æˆåˆ†æ–¹å‘ã®åˆ†æ•£</strong></div>';
            eigenHtml += '<ul style="margin-left: 20px;">';
            eigenHtml += `<li>Î»â‚ = ${eigenvalues[0].toFixed(3)}: ç¬¬1ä¸»æˆåˆ†æ–¹å‘ã®ãƒ‡ãƒ¼ã‚¿ã®åˆ†æ•£</li>`;
            eigenHtml += `<li>Î»â‚‚ = ${eigenvalues[1].toFixed(3)}: ç¬¬2ä¸»æˆåˆ†æ–¹å‘ã®ãƒ‡ãƒ¼ã‚¿ã®åˆ†æ•£</li>`;
            eigenHtml += '</ul>';
            eigenHtml += '<br>';
            eigenHtml += '<div style="margin-bottom: 10px;">ğŸ“ <strong>å¯„ä¸ç‡ã®æ„å‘³</strong></div>';
            const contribution1 = (eigenvalues[0] / (eigenvalues[0] + eigenvalues[1]) * 100).toFixed(1);
            const contribution2 = (eigenvalues[1] / (eigenvalues[0] + eigenvalues[1]) * 100).toFixed(1);
            eigenHtml += `$$\\text{ç¬¬1ä¸»æˆåˆ†ã®å¯„ä¸ç‡} = \\frac{\\lambda_1}{\\lambda_1 + \\lambda_2} = \\frac{${eigenvalues[0].toFixed(3)}}{${(eigenvalues[0] + eigenvalues[1]).toFixed(3)}} = ${contribution1}\\%$$`;
            eigenHtml += `<div style="margin-top: 10px;">â†’ ç¬¬1ä¸»æˆåˆ†ã ã‘ã§å…¨ä½“ã®<strong>${contribution1}%</strong>ã®æƒ…å ±ï¼ˆåˆ†æ•£ï¼‰ã‚’èª¬æ˜</div>`;
            eigenHtml += '</div>';
            
            // é‡è¦ãªæ•°å­¦çš„èƒŒæ™¯ã‚’è¿½åŠ 
            eigenHtml += '<div style="margin-top: 15px; padding: 15px; background: #ffebee; border-radius: 5px; font-size: 14px; border-left: 4px solid #ef5350;">';
            eigenHtml += '<strong>ğŸ” ãªãœå›ºæœ‰ãƒ™ã‚¯ãƒˆãƒ«ãŒä¸»æˆåˆ†ã«ãªã‚‹ã®ã‹ï¼Ÿ</strong><br><br>';
            eigenHtml += '<div style="margin-bottom: 15px;">';
            eigenHtml += '<strong>å›ºæœ‰ãƒ™ã‚¯ãƒˆãƒ«ã‚’å–ã‚‹ç†ç”±ï¼š</strong><br>';
            eigenHtml += 'ãƒ‡ãƒ¼ã‚¿ãŒã‚ˆãã°ã‚‰ã¤ã„ã¦ã„ã‚‹æ–¹å‘ã«åˆã‚ã›ã¦ç©ºé–“ã®è»¸ã‚’å–ã‚Šç›´ã™ã¨ã„ã†ã“ã¨';
            eigenHtml += '</div>';
            eigenHtml += '<div style="margin-bottom: 15px;">';
            eigenHtml += '<strong>æ•°å­¦çš„ãªæ„å‘³ï¼š</strong><br>';
            eigenHtml += 'åˆ†æ•£ãŒæœ€å¤§ã«ãªã‚‹ã‚ˆã†ãªãƒ™ã‚¯ãƒˆãƒ«ã‚’æ¢ã™å•é¡Œã¯ã€æ•°å­¦çš„ã«ã€Œåˆ†æ•£å…±åˆ†æ•£è¡Œåˆ—ã®å›ºæœ‰ãƒ™ã‚¯ãƒˆãƒ«ã€ã‚’æ±‚ã‚ã‚‹å•é¡Œã«å¸°ç€ã™ã‚‹';
            eigenHtml += '</div>';
            eigenHtml += '<div style="margin-bottom: 15px;">';
            eigenHtml += '<strong>æœ€é©åŒ–å•é¡Œã¨ã®é–¢ä¿‚ï¼š</strong><br>';
            eigenHtml += '$$\\max_{\\|\\mathbf{v}\\|=1} \\mathbf{v}^T C \\mathbf{v}$$';
            eigenHtml += 'ã“ã®æœ€é©åŒ–å•é¡Œã®è§£ãŒã€æœ€å¤§å›ºæœ‰å€¤ã«å¯¾å¿œã™ã‚‹å›ºæœ‰ãƒ™ã‚¯ãƒˆãƒ«ï¼ˆç¬¬1ä¸»æˆåˆ†ï¼‰ã«ãªã‚‹';
            eigenHtml += '</div>';
            eigenHtml += '<div>';
            eigenHtml += '<strong>çµè«–ï¼š</strong><br>';
            eigenHtml += 'æœ€å¤§ã®å›ºæœ‰å€¤ã«å¯¾å¿œã™ã‚‹å›ºæœ‰ãƒ™ã‚¯ãƒˆãƒ«ãŒç¬¬1ä¸»æˆåˆ†ã®æ–¹å‘ã«ãªã‚‹ç†ç”±ã¯ã€<br>';
            eigenHtml += 'ãã‚ŒãŒãƒ‡ãƒ¼ã‚¿ã®åˆ†æ•£ã‚’æœ€å¤§åŒ–ã™ã‚‹æ–¹å‘ã ã‹ã‚‰';
            eigenHtml += '</div>';
            eigenHtml += '</div>';
            
            document.getElementById('eigenAnalysis').innerHTML = eigenHtml;
            
            // MathJaxã§æ•°å¼ã‚’å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
            if (window.MathJax && window.MathJax.typeset) {
                MathJax.typeset();
            } else if (window.MathJax && window.MathJax.Hub) {
                MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
            }
        }

        function updateResultTable() {
            const total = eigenvalues[0] + eigenvalues[1];
            const contribution1 = (eigenvalues[0] / total * 100).toFixed(1);
            const contribution2 = (eigenvalues[1] / total * 100).toFixed(1);
            
            let tableHtml = '<tr><th>ä¸»æˆåˆ†</th><th>å›ºæœ‰å€¤</th><th>å¯„ä¸ç‡(%)</th><th>ç´¯ç©å¯„ä¸ç‡(%)</th><th>å›ºæœ‰ãƒ™ã‚¯ãƒˆãƒ«</th></tr>';
            
            tableHtml += '<tr>';
            tableHtml += '<td style="background: #ffebee;">ç¬¬1ä¸»æˆåˆ†</td>';
            tableHtml += `<td>${eigenvalues[0].toFixed(4)}</td>`;
            tableHtml += `<td>${contribution1}</td>`;
            tableHtml += `<td>${contribution1}</td>`;
            tableHtml += `<td>[${eigenvectors[0][0].toFixed(3)}, ${eigenvectors[0][1].toFixed(3)}]</td>`;
            tableHtml += '</tr>';
            
            tableHtml += '<tr>';
            tableHtml += '<td style="background: #e8f5e9;">ç¬¬2ä¸»æˆåˆ†</td>';
            tableHtml += `<td>${eigenvalues[1].toFixed(4)}</td>`;
            tableHtml += `<td>${contribution2}</td>`;
            tableHtml += `<td>100.0</td>`;
            tableHtml += `<td>[${eigenvectors[1][0].toFixed(3)}, ${eigenvectors[1][1].toFixed(3)}]</td>`;
            tableHtml += '</tr>';
            
            document.getElementById('resultTable').innerHTML = tableHtml;
            
            // è§£é‡ˆ
            let interpretation = `ç¬¬1ä¸»æˆåˆ†ãŒå…¨ä½“ã®<strong>${contribution1}%</strong>ã®æƒ…å ±ã‚’èª¬æ˜ã—ã¦ã„ã¾ã™ã€‚`;
            if (parseFloat(contribution1) > 80) {
                interpretation += '<br>â†’ ãƒ‡ãƒ¼ã‚¿ã¯1æ¬¡å…ƒã§ã»ã¼è¡¨ç¾å¯èƒ½ï¼ˆå¼·ã„ç›¸é–¢ãŒã‚ã‚‹ï¼‰';
            } else if (parseFloat(contribution1) > 60) {
                interpretation += '<br>â†’ ã‚ã‚‹ç¨‹åº¦ã®æ¬¡å…ƒå‰Šæ¸›ãŒå¯èƒ½';
            } else {
                interpretation += '<br>â†’ ä¸¡æ–¹ã®ä¸»æˆåˆ†ãŒé‡è¦ï¼ˆç›¸é–¢ãŒå¼±ã„ï¼‰';
            }
            
            document.getElementById('interpretation').innerHTML = interpretation;
        }

        // åˆæœŸå®Ÿè¡Œ
        generateAndAnalyze();
    </script>
</body>
</html>